{% extends 'base.html' %}
{% load crispy_forms_tags %}
{{ form|crispy }}
{% block content %}


<!-- your_template.html -->
 <h3>Create Product Rows</h3>
<form method="post" action={% url 'add_row' %}>
  {% csrf_token %}
  

  <div class="form-group">
    <label for="category" class="form-label">Category</label>
    <select id="category" name="category" class="form-control">
      <option value="">Select a category</option>
      {% for category in categories %}
        <option value="{{ category.category_id }}">{{ category.category_name }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="form-group">
    <label for="subcategory" class="form-label">Subcategory</label>
    <select id="subcategory" name="subcategory" class="form-control">
      <option value="">Select a subcategory</option>
    </select>
  </div>

  <button type="submit" class="btn btn-primary">Add Row</button>
</form>

{% endblock %}

{% block scripts %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function () {
    $("#category").change(function () {
        const categoryId = $(this).val(); // get selected category
        if (!categoryId) {
            $("#subcategory").html('<option value="">Select a subcategory</option>');
            return;
        }

        $.ajax({
            url: "{% url 'ajax_load_subcategories' %}",
            type: "GET",
            data: {
                'category_id': categoryId,
                't': new Date().getTime() // prevent caching
            },
            cache: false,
            success: function (data) {
                $("#subcategory").html('<option value="">Select a subcategory</option>');
                data.forEach(function (subcategory) {
                    $("#subcategory").append(
                        '<option value="' + subcategory.subcategory_id + '">' + subcategory.subcategory_name + '</option>'
                    );
                });
            }
        });
    });
});
</script>
{% endblock %}

 
