{% extends 'base.html' %}
{% block content %}

{% if user.is_authenticated %}
<div class="container mt-4">
  {% load static %}

{% if not profile.profile_pic %}
  <img src="{% static 'images/default.png' %}" alt="Default Picture" width="120" height="120" style="border-radius:50%;">    
{% else %}
  <img src="{{ profile.profile_pic.url }}" alt="Profile Picture" width="120" height="120" style="border-radius:50%;">
    
{% endif %}
  <h4 class="text-success">Welcome {{ user.first_name }} {{ user.last_name }}</h4>

  <div class="row mt-4">
    <!-- Update Profile Section -->
    <div class="col-md-6">
      <div class="card p-4 shadow-sm">
        <h4 class="text-success mb-3">Update Profile</h4>
        <form method="post" action="{% url 'profile_update' %}" enctype="multipart/form-data">
          {% csrf_token %}
          <div class="mb-3">
            <label for="name" class="form-label fw-bold">Username</label>
            <input type="text" class="form-control rounded-3" id="name" name="name" value="{{ user.username }}">
          </div>

          <div class="mb-3">
            <label for="email" class="form-label fw-bold">Email</label>
            <input type="email" class="form-control rounded-3" id="email" name="email" value="{{ user.email }}">
          </div>

          <div class="mb-3">
            <label for="profile_pic" class="form-label fw-bold">Profile Picture</label>
            <input type="file" class="form-control rounded-3" id="profile_pic" name="profile_pic">
          </div>

          <button type="submit" class="btn btn-custom w-100 rounded-3">Update Profile</button>
        </form>
      </div>
    </div>

    <!-- Reset Password Section -->
    <div class="col-md-6">
      <div class="card p-4 shadow-sm">
        <h4 class="text-success mb-3">Reset Password</h4>
        <form method="post" action="{% url 'reset_password' %}">
          {% csrf_token %}
          <div class="mb-3">
            <label for="old_password" class="form-label fw-bold">Old Password</label>
            <input type="password" class="form-control rounded-3" id="old_password" name="old_password" minlength="6" required>
          </div>

          <div class="mb-3">
            <label for="new_password1" class="form-label fw-bold">New Password</label>
            <input type="password" class="form-control rounded-3" id="new_password1" name="new_password1" minlength="6" required>
          </div>

          <div class="mb-3">
            <label for="new_password2" class="form-label fw-bold">Confirm New Password</label>
            <input type="password" class="form-control rounded-3" id="new_password2" name="new_password2" minlength="6" required>
          </div>

          <button type="submit" class="btn btn-custom w-100 rounded-3">Change Password</button>
        </form>
      </div>
    </div>
  </div>
</div>

{% else %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)),
                  url('https://images.unsplash.com/photo-1598454447410-71ec5d379f25') no-repeat center center/cover;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .card {
      background: #ffffffdd;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
    .card h2 {
      color: #2d572c;
    }
    .btn-custom {
      background-color: #2d572c;
      color: white;
    }
    .btn-custom:hover {
      background-color: #1e3f20;
      color: white;
    }
    .footer a {
      color: #2d572c;
      font-weight: bold;
      text-decoration: none;
    }
    .footer a:hover {
      text-decoration: underline;
    }
  </style>

  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-6 col-lg-4">
        <div class="card p-4 text-center">
          <h2 class="mb-2">Farmer's Portal</h2>
          <p class="mb-4">Sign in to manage your crops</p>
          
          <form method="post" action="{% url 'home' %}">
            {% csrf_token %}
            <div class="mb-3 text-start">
              <label for="username" class="form-label fw-bold text-success">Username</label>
              <input type="text" class="form-control rounded-3" id="username" name="username" placeholder="Enter your username" required>
            </div>
            
            <div class="mb-3 text-start">
              <label for="password" class="form-label fw-bold text-success">Password</label>
              <input type="password" class="form-control rounded-3" id="password" name="password" placeholder="Enter your password" required>
            </div>
            
            <button type="submit" class="btn btn-custom w-100 py-2 rounded-3">Sign In</button>
          </form>
          
          <div class="footer mt-3">
            <p><a href="#">Forgot Password</a></p>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endif %}


{% endblock %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
function calculateAmount() {
    const qty = parseFloat(document.getElementById('id_qty').value) || 0;
    const rate = parseFloat(document.getElementById('id_rate').value) || 0;
    const amount = qty * rate;
    document.getElementById('id_amount').value = amount.toFixed(2);
}
</script>